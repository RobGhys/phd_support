<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ResNet Residual Connections</title>
    <style>
        body {
            font-family: 'Times New Roman', Times, serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: white;
        }
        .container {
            background: white;
            padding: 20px;
            max-width: 900px;
        }
        svg {
            display: block;
            margin: 0 auto;
            border: 0.5px solid #999;
            background-color: white;
        }
        .figure-title {
            text-align: center;
            font-size: 14px;
            font-weight: normal;
            margin-bottom: 15px;
            color: #000;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="container">
        <svg width="850" height="520" viewBox="0 0 850 520">
            <!-- Define arrowhead markers -->
            <defs>
                <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                    <polygon points="0 0, 6 3, 0 6" fill="#000" />
                </marker>
                <marker id="arrowhead-gray" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
                    <polygon points="0 0, 6 3, 0 6" fill="#666" />
                </marker>
            </defs>

            <!-- Main content area -->
            <g transform="translate(0, 60)">
                <!-- Input -->
                <rect x="80" y="120" width="80" height="80" fill="#f8f8f8" stroke="#000" stroke-width="1.2"/>
                <text x="120" y="165" text-anchor="middle" font-size="18" font-family="Times New Roman, serif" font-style="italic">x</text>

                <!-- Weight Layer 1 -->
                <rect x="230" y="120" width="120" height="80" fill="#e8e8e8" stroke="#000" stroke-width="1.2"/>
                <text x="290" y="148" text-anchor="middle" font-size="12" font-family="Times New Roman, serif" font-weight="bold">weight layer</text>
                <text x="290" y="168" text-anchor="middle" font-size="11" font-family="Times New Roman, serif">3×3 conv</text>
                <text x="290" y="184" text-anchor="middle" font-size="11" font-family="Times New Roman, serif">BN, ReLU</text>

                <!-- Weight Layer 2 -->
                <rect x="420" y="120" width="120" height="80" fill="#e8e8e8" stroke="#000" stroke-width="1.2"/>
                <text x="480" y="148" text-anchor="middle" font-size="12" font-family="Times New Roman, serif" font-weight="bold">weight layer</text>
                <text x="480" y="168" text-anchor="middle" font-size="11" font-family="Times New Roman, serif">3×3 conv</text>
                <text x="480" y="184" text-anchor="middle" font-size="11" font-family="Times New Roman, serif">BN</text>

                <!-- Addition Symbol -->
                <circle cx="620" cy="160" r="26" fill="white" stroke="#000" stroke-width="1.2"/>
                <line x1="604" y1="160" x2="636" y2="160" stroke="#000" stroke-width="2.5"/>
                <line x1="620" y1="144" x2="620" y2="176" stroke="#000" stroke-width="2.5"/>

                <!-- Output -->
                <rect x="690" y="120" width="80" height="80" fill="#f8f8f8" stroke="#000" stroke-width="1.2"/>
                <text x="730" y="165" text-anchor="middle" font-size="14" font-family="Times New Roman, serif">ReLU</text>

                <!-- Main path arrows -->
                <line x1="160" y1="160" x2="230" y2="160" stroke="#000" stroke-width="2" marker-end="url(#arrowhead)"/>
                <line x1="350" y1="160" x2="420" y2="160" stroke="#000" stroke-width="2" marker-end="url(#arrowhead)"/>
                <line x1="540" y1="160" x2="595" y2="160" stroke="#000" stroke-width="2" marker-end="url(#arrowhead)"/>
                <line x1="646" y1="160" x2="690" y2="160" stroke="#000" stroke-width="2" marker-end="url(#arrowhead)"/>

                <!-- Identity shortcut connection -->
                <path d="M 160 160 L 190 160 L 190 280 L 620 280 L 620 186" 
                      stroke="#666" stroke-width="2.5" fill="none" marker-end="url(#arrowhead-gray)"
                      stroke-dasharray="8,4"/>

                <!-- Labels -->
                <text x="385" y="95" text-anchor="middle" font-size="15" font-family="Times New Roman, serif" font-style="italic">F(x)</text>
                <text x="620" y="95" text-anchor="middle" font-size="15" font-family="Times New Roman, serif" font-style="italic">F(x) + x</text>
                <text x="405" y="305" text-anchor="middle" font-size="13" font-family="Times New Roman, serif" fill="#666">identity</text>

                <!-- Dimension annotations with proper formatting -->
                <g font-family="Times New Roman, serif" font-size="11" fill="#333">
                    <!-- Input dimensions -->
                    <text x="120" y="225" text-anchor="middle">
                        <tspan font-style="italic">H</tspan> × <tspan font-style="italic">W</tspan> × <tspan font-style="italic">C</tspan>
                    </text>
                    
                    <!-- First weight layer dimensions -->
                    <text x="290" y="225" text-anchor="middle">
                        <tspan font-style="italic">H</tspan> × <tspan font-style="italic">W</tspan> × <tspan font-style="italic">C</tspan>
                    </text>
                    
                    <!-- Second weight layer dimensions -->
                    <text x="480" y="225" text-anchor="middle">
                        <tspan font-style="italic">H</tspan> × <tspan font-style="italic">W</tspan> × <tspan font-style="italic">C</tspan>
                    </text>
                    
                    <!-- Output dimensions -->
                    <text x="730" y="225" text-anchor="middle">
                        <tspan font-style="italic">H</tspan> × <tspan font-style="italic">W</tspan> × <tspan font-style="italic">C</tspan>
                    </text>
                </g>
            </g>

            <!-- Legend at bottom -->
            <g transform="translate(80, 380)">
                <rect x="0" y="0" width="690" height="90" fill="#fafafa" stroke="#999" stroke-width="0.8"/>
                
                <!-- Legend items arranged in two rows -->
                <g transform="translate(40, 20)">
                    <!-- Row 1 -->
                    <rect x="0" y="0" width="35" height="20" fill="#f8f8f8" stroke="#000" stroke-width="1"/>
                    <text x="40" y="15" font-size="11" font-family="Times New Roman, serif">Input/Output Layer</text>
                    
                    <rect x="200" y="0" width="35" height="20" fill="#e8e8e8" stroke="#000" stroke-width="1"/>
                    <text x="240" y="15" font-size="11" font-family="Times New Roman, serif">Convolutional Layer with BN</text>
                    
                    <circle cx="430" cy="10" r="10" fill="white" stroke="#000" stroke-width="1"/>
                    <text x="430" y="15" text-anchor="middle" font-size="16"> + </text>
                    <text x="480" y="15" font-size="11" font-family="Times New Roman, serif">Element-wise Sum</text>
                    
                    <!-- Row 2 -->
                    <line x1="0" y1="45" x2="35" y2="45" stroke="#666" stroke-width="2.5" stroke-dasharray="8,4"/>
                    <text x="40" y="50" font-size="11" font-family="Times New Roman, serif">Identity Shortcut Connection</text>
                    
                    <text x="240" y="50" font-size="11" font-family="Times New Roman, serif" font-style="italic">H</text>
                    <text x="250" y="50" font-size="11" font-family="Times New Roman, serif">: height,</text>
                    <text x="300" y="50" font-size="11" font-family="Times New Roman, serif" font-style="italic">W</text>
                    <text x="312" y="50" font-size="11" font-family="Times New Roman, serif">: width,</text>
                    <text x="360" y="50" font-size="11" font-family="Times New Roman, serif" font-style="italic">C</text>
                    <text x="370" y="50" font-size="11" font-family="Times New Roman, serif">: channels</text>
                </g>
            </g>
        </svg>
    </div>
</body>
</html>